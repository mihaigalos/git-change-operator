---
apiVersion: gco.galos.one/v1
kind: GitCommit
metadata:
  name: test-cel-functionality
  namespace: default
spec:
  repository: https://github.com/mihaigalos/test.git
  branch: main
  commitMessage: "Testing CEL functionality in Git Change Operator v1.1.0"
  authSecretRef: test-git-secret
  authSecretKey: token
  
  # Test REST API with CEL-based response parsing
  restAPI:
    url: "https://httpbin.org/json" # Simple JSON endpoint for testing
    method: "GET"
    timeoutSeconds: 30
    maxStatusCode: 299
    
    # CEL-based response parsing configuration
    responseParsing:
      # Condition: Check if we have slideshow data (use 'in' operator for maps)
      condition: '"slideshow" in response && "title" in response.slideshow'
      
      # Data expression: Extract slideshow title and author  
      dataExpression: 'response.slideshow.title + " by " + response.slideshow.author'
      
      # Output format: Use 'data' (result of dataExpression) and 'now' timestamp
      outputFormat: 'string(now) + " - " + data'

  files:
  - path: test/cel-demo.txt
    content: "placeholder"  # This will be replaced by CEL-processed API response
    useRestAPIData: true
  
  - path: test/static-info.md
    content: |
      # CEL Functionality Test
      
      This file demonstrates the Git Change Operator v1.1.0 with CEL support.
      
      ## Features Tested
      - REST API integration with httpbin.org
      - CEL condition evaluation
      - CEL data expression processing
      - CEL output formatting with timestamps
      
      ## API Response Processing
      The operator fetched data from httpbin.org/json and processed it using CEL expressions.