---
apiVersion: gco.galos.one/v1
kind: PullRequest
metadata:
  name: test-pullrequest-ttl
  namespace: default
spec:
  repository: https://github.com/mihaigalos/test.git
  baseBranch: main
  headBranch: feature-ttl-test-20251003
  title: "Test PullRequest with TTL functionality"
  body: |
    This PR demonstrates TTL (Time-To-Live) functionality for PullRequest resources.
    
    The resource will be automatically deleted after 1 minute due to TTL configuration.
  authSecretRef: test-git-secret
  authSecretKey: token
  ttlMinutes: 1  # Resource will be auto-deleted after 1 minute
  
  # Test REST API with CEL-based response parsing (updated to new array format)
  restAPIs:
    - name: "json-test"
      url: "https://httpbin.org/json"
      method: "GET"
      timeoutSeconds: 30
      maxStatusCode: 299
      
      # CEL-based response parsing configuration
      responseParsing:
        # Condition: Check if we have slideshow data
        condition: '"slideshow" in response && "author" in response.slideshow'
        
        # Data expression: Extract slideshow author
        dataExpression: 'response.slideshow.author'
      
      # Output format: Add TTL info to the output
      outputFormat: '"PR TTL Test - Author: " + data + " (expires in 1 minute)"'

  files:
  - path: test/pr-ttl-demo.txt
    content: "placeholder"  # This will be replaced by CEL-processed API response
    useRestAPIData: true
  
  - path: README-ttl.md
    content: |
      # PullRequest TTL Test
      
      This demonstrates TTL functionality for PullRequest resources.
      
      - TTL: 1 minute
      - Auto-deletion based on creation timestamp
      - CEL processing with REST API integration